name: Deploy Bedrock Chat

on:
  push:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  deploy:
    runs-on: self-hosted
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Deploy everything
      run: |
        # Apply in order - no waiting, no complicated checks
        echo "Deploying Bedrock Chat to Kubernetes..."
        
        kubectl apply -f namespace.yaml
        kubectl apply -f secrets/
        kubectl apply -f configmaps/
        kubectl apply -f metrics-server-custom.yaml
        kubectl apply -f statefulsets/
        kubectl apply -f services/
        kubectl apply -f monitoring/
        kubectl apply -f network-policies/
        kubectl apply -f hpa/
        kubectl apply -f ingress/
        
        echo "Deployment completed!"
        
        # Quick status check
        echo "Current status:"
        kubectl get all -n bedrock-chat-v2
